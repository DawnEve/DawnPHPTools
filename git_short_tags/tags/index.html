<html>
<head>
<link rel="stylesheet" href="tags.css" />
<title>仿163博客添加文章标签功能</title>
</head>
<body>
<h1>仿163博客添加文章标签功能</h1>
<pre>
1.前台基于js，后台基于php。
2.完稿后第一行隐藏，用于提交表单：用户添加的标签。
3.相关博客：http://tieba.baidu.com/p/4174331708
</pre>

<hr><br>
<div id=edit class="tagbox">
	<input type="text" style='display:block' name="tags" value="angular,bootstrap">
	<span>标签：</span>
	<div class="new">
		<ul class="clearfix">
			<li>
				<span class="tag-btn">angular</span>
				<span class="delete-tag-btn" title="删除">x</span>
			</li>
			<li>
				<span class="tag-btn">bootstrap</span>
				<span class="delete-tag-btn" title="删除">x</span>
			</li>
		</ul>
		<div class="tag-input" style="width: 425px;">
			<input type="text" maxlength="20">
		</div>
	</div>
   
	<div class="taghint">
		<a onclick="return false;" hidefocus="true" href="#">
			<span>[Tip]</span>
			<span class="noshow">标签是由用户定义的、概括文章内容的关键词，比日志分类更准确、更具体。经常使用标签，可以让读者更加方便地找到感兴趣的文章。</span>
		</a>
		<span class="fc06">请使用空格或回车分隔不同标签</span>
	</div>
	
	<div class="old">      
		<div class="fc06">使用过的标签：</div>
		<div class="ztag">        
			<span>html</span>
			<span>css</span>
			<span>js</span>
			<span>jQ</span>
			<span>nodeJS</span>
			<span>书籍</span>
			<span>摄影</span>
			<span>源代码</span>   
		</div>
	  
		<div class="fc06">
			<p>请使用空格或回车分隔不同标签, 最多可输入5个</p>
		</div>
	</div>

</div>
<script>
//tools
function $(s){return document.getElementById(s);}
//操作dom元素
function trim(str){ //删除左右两端的空格
	return str.replace(/(^\s*)|(\s*$)/g, "");
}
function ltrim(str){ //删除左边的空格
	return str.replace(/(^\s*)/g,"");
}
function rtrim(str){ //删除右边的空格
	return str.replace(/(\s*$)/g,"");
}
//获取样式
/********************************
*获取非行间样式 ok
********************************
*用js的style方法(obj.style.attr)可以获得html标签的样式,但是不能获取非行间样式。
*那么怎么用js获取css的非行间样式呢?
*在IE下可以用currentStyle,而在火狐下面我们需要用到getComputed
*http://miostudio.blog.163.com/blog/static/22076512920142772540838/
*/
function getStyle(obj, attr){
	if(obj.currentStyle){
		return obj.currentStyle[attr];	//for IE only
	}else{
		return getComputedStyle(obj, false)[attr];//for ff/chrome only
	}
}

//===================
window.onload=function(){
	var tagBox=$('edit');
	//新标签输入框
	 newTag=tagBox.getElementsByClassName('new')[0];
	 newTag_div=newTag.getElementsByTagName('div')[0];
	//新标签提交框（应该隐藏）
	 tagInFrom=tagBox.getElementsByTagName('input')[0];
	
	//----------------------------
	//事件及其处理函数
	//----------------------------
	//初始化时获取焦点
	var newTag_input=newTag.getElementsByTagName('input')[0];
	newTag_input.focus();
	
	//鼠标悬停时显示提示
	var switcher=(tagBox.getElementsByClassName('taghint')[0]).getElementsByTagName('span')[0];//按钮
	var hint=tagBox.getElementsByClassName('noshow')[0];//提示文字
	switcher.onmouseover=function(){
		hint.style.visibility='visible';
		//鼠标移出时隐藏提示
		switcher.onmouseout=function(){
			hint.style.visibility='hidden';
		}
	}
	 
	//空格或回车 处理标签
	newTag_input.onkeydown=function(event){
		//获取事件
		var e = event || window.event || arguments.callee.caller.arguments[0];
		if((e && e.keyCode==13) || (e && e.keyCode==32)){ // enter键 或空格
			//获取输入
			var newTag=trim(this.value);
			addNewTag(newTag);
		}
	}
	
	//旧标签的单击事件
	var oldTag=tagBox.getElementsByClassName('old')[0];
	var aOldTag=oldTag.getElementsByTagName('span');
	for(var i=0;i<aOldTag.length; i++){
		//获取该标签
		aOldTag[i].onclick=function(){
			var tagName=this.innerHTML;
			//添加该标签
			addNewTag(tagName);
		}
	}
	

	//处理输入的新标签
	function addNewTag(tagName){
		//处理该输入，是否够5个了？
		tagsNow=tagInFrom.value;
		aTags=tagsNow.split(',');
		//alert(aTags.length);
		
		if(aTags.length>4){
			alert('最多可添加5个标签');
			newTag_input.value="";
			return;//如果超过5个，则返回
		}
		
		//是否重复了？
		if(aTags.indexOf(tagName)!=-1){
			newTag_input.value="";
			return;//如果已经有了，则返回
		}
		
		//1.显示到隐藏input中
		aTags.push(tagName);
		tagInFrom.value=aTags.join(',');
		
		//2.当前input清空
		newTag_input.value="";
		//3.当前input缩短到很短
		newTag_div.style.width=10 +'px';
		//4.显示为灰背景标签
		li=getDom(tagName);
		//插入到ul的最后
		 ul=newTag.getElementsByTagName('ul')[0];
		ul.appendChild(li);
		//5.再次调整input长度
		newTag_div.style.width=( parseInt(getStyle(newTag,'width')) -parseInt(getStyle(ul,'width')) ) +'px';
	}
}
	
	//根据传入的tag名字创造dom并返回
	function getDom(tagName){
		//新建dom
		s1=document.createElement('span');
		s1.setAttribute('class','tag-btn');
		s1.innerHTML=tagName;

		s2=document.createElement('span');
		s2.setAttribute('class','delete-tag-btn');
		s2.setAttribute('title','删除');
		s2.innerHTML='x';

		li=document.createElement('li');
		li.appendChild(s1);
		li.appendChild(s2);
		
		return li;
	}
	
	

</script>
</body>
</html>